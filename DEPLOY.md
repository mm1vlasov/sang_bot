# Развёртывание бота (Git и хостинг)

Краткая инструкция по выкладке проекта в репозиторий и запуску на хостинге (в том числе BotHost).

---

## Права бота (Permissions)

Чтобы всё работало, у бота на сервере должны быть такие права:

| Право | Зачем |
|-------|--------|
| **Просматривать каналы** (View Channels) | Видеть каналы, куда отправлять аудит и сообщения с кнопками. |
| **Отправлять сообщения** (Send Messages) | Писать в каналы (эмбеды, кнопки, ответы на команды). |
| **Встраивать ссылки** (Embed Links) | Отправлять эмбеды (все кадровые сообщения — в эмбедах). |
| **Читать историю сообщений** (Read Message History) | Искать своё setup-сообщение в канале и редактировать его при старте; читать сообщения с кнопками для обработки. |
| **Управление ролями** (Manage Roles) | Команды `/invite` (выдача SANG + Academy) и `/transfer` (смена отдела). Роль бота на сервере должна быть **выше** всех ролей, которые он выдаёт или снимает. |
| **Упоминать @everyone, @here и все роли** (Mention @everyone, @here, and All Roles) | Упоминание роли «Старший состав» в рапортах на увольнение и запросах на повышение. |

**Минимальный набор (Permission Integer для ссылки приглашения):** `268614232`

Ссылка для приглашения бота с этими правами (подставьте свой `APPLICATION_ID`):

```
https://discord.com/api/oauth2/authorize?client_id=APPLICATION_ID&permissions=268614232&scope=bot%20applications.commands
```

В Discord Developer Portal: **Bot** → **Privileged Gateway Intents** — для текущего кода достаточно включить только **Server Members Intent**, если бот должен корректно получать участников при выборе пользователя в слэш-командах (например, в `/invite` «кого»).

---

## Подготовка к Git

1. **Токен не попадает в репозиторий.** Файл `config.json` добавлен в `.gitignore` — он не будет закоммичен. Токен задаётся отдельно на хостинге (переменная окружения).

2. **Шаблон конфигурации.** В репозитории лежит `config.example.json` — структура конфига без секретов. Для локальной разработки скопируйте его в `config.json` и заполните (включая токен). На хостинге токен указывается через переменную окружения.

3. **Первый коммит:**
   ```bash
   git init
   git add .
   git status   # убедитесь, что config.json не в списке
   git commit -m "Initial commit: SANG кадровый бот"
   git remote add origin <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
   git push -u origin main
   ```

---

## Запуск на BotHost (или другом хостинге)

1. **Подключите репозиторий** к хостингу (Git URL, ветка `main` / `master`).

2. **Переменные окружения.** В панели хостинга задайте:
   - `BOT_TOKEN` — токен бота из Discord Developer Portal (или `DISCORD_TOKEN`, бот поддерживает оба имени).

3. **Конфигурация.** На хостинге должен быть файл `config.json` с вашими ID сервера, каналов и ролей. Варианты:
   - **Рекомендуется:** создать `config.json` на хостинге вручную (скопировать содержимое из `config.example.json` и подставить свои ID), токен оставить пустым `""` — бот возьмёт его из `BOT_TOKEN`.
   - Либо загрузить свой `config.json` через панель хостинга (без токена или с пустым полем `token`).

4. **Команда запуска.** Обычно:
   ```bash
   npm install
   npm start
   ```
   или `node bot.js`. На BotHost, как правило, указывается `npm start` или `node bot.js` как команда старта.

5. **Node.js.** Убедитесь, что на хостинге выбран Node.js 18 или выше.

---

## Проверка после деплоя

- В логах должно появиться: `ИмяБота запустился!` и сообщение о регистрации слэш-команд.
- Если бот не входит: проверьте, что переменная `BOT_TOKEN` задана и токен действителен.
- Если пишет «канал не найден»: проверьте ID каналов и ролей в `config.json` на хостинге.

---

## Локальная разработка (после клонирования)

```bash
git clone <URL_РЕПОЗИТОРИЯ>
cd bot
npm install
cp config.example.json config.json
# Отредактируйте config.json: подставьте clientId, guildId, каналы, роли и токен
npm start
```

Токен можно указать в `config.json` локально или задать переменную окружения `BOT_TOKEN` / `DISCORD_TOKEN`.
